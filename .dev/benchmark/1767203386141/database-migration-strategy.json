{
  "caseId": "database-migration-strategy",
  "caseName": "레거시 DB 마이그레이션 전략",
  "caseType": "tech",
  "category": "migration",
  "controversyLevel": "high",
  "singleAI": {
    "response": "# MySQL 레거시 시스템 현대화 전략 분석\n\n## 요약: **옵션 A (MySQL 8 + 읽기 복제본 + ProxySQL) 추천**\n\n귀사의 상황에서 가장 현실적이고 리스크가 낮은 선택입니다.\n\n---\n\n## 선택지별 상세 분석\n\n### A) MySQL 8 + 읽기 복제본 + ProxySQL ✅ **추천**\n\n```\n┌─────────────┐     ┌─────────────────┐     ┌──────────────┐\n│   App       │────▶│    ProxySQL     │────▶│  MySQL 8     │\n│   Servers   │     │  (Query Router) │     │  Primary     │\n└─────────────┘     └─────────────────┘     └──────────────┘\n                            │                      │\n                    ┌───────┴───────┐              │ Replication\n                    ▼               ▼              ▼\n              ┌──────────┐   ┌──────────┐   ┌──────────────┐\n              │ Read     │   │ Read     │   │ Analytics    │\n              │ Replica 1│   │ Replica 2│   │ Replica      │\n              └──────────┘   └──────────┘   └──────────────┘\n```\n\n**장점:**\n- 저장 프로시저 50개 그대로 유지 (마이그레이션 비용 최소)\n- 9:1 읽기 비율에 최적 - 읽기 복제본으로 90% 트래픽 분산\n- MySQL 8의 CTE, 윈도우 함수로 복잡한 JOIN 최적화 가능\n- 팀 학습 곡선 최소\n\n**단점:**\n- 쓰기 확장성 한계 (단일 Primary)\n- 근본적인 스키마 유연성 해결 안됨\n\n**적합도:** ★★★★★ (현재 상황에 최적)\n\n---\n\n### B) PostgreSQL + Citus\n\n**장점:**\n- 진정한 수평 확장 (쓰기 포함)\n- 더 강력한 JSON 지원, 파티셔닝\n\n**단점:**\n- 저장 프로시저 50개 전면 재작성 필요\n- MySQL → PostgreSQL 문법 차이 (마이그레이션 6-12개월)\n- 팀 재교육 비용\n\n**적합도:** ★★★☆☆ (쓰기 확장이 급하다면 고려)\n\n---\n\n### C) MongoDB 폴리글랏\n\n**장점:**\n- 스키마 유연성 확보\n- 특정 도메인(로그, 세션 등)에 적합\n\n**단점:**\n- 복잡한 JOIN이 문제인데, MongoDB는 JOIN에 더 약함\n- 두 시스템 운영 복잡도 증가\n- 트랜잭션 일관성 관리 어려움\n\n**적합도:** ★★☆☆☆ (현재 문제 해결에 부적합)\n\n---\n\n### D) PlanetScale/TiDB (NewSQL)\n\n**장점:**\n- MySQL 호환 + 수평 확장\n- 스키마 변경 온라인으로 가능 (PlanetScale)\n\n**단점:**\n- 저장 프로시저 미지원 또는 제한적\n- 비용 (500GB + 1억 쿼리/일 = 월 $2,000-5,000+)\n- 복잡한 쿼리 성능 예측 어려움\n\n**적합도:** ★★★☆☆ (저장 프로시저 의존도가 낮았다면 좋은 선택)\n\n---\n\n## 추천 마이그레이션 로드맵 (옵션 A)\n\n### Phase 1: 기반 구축\n```\n목표: MySQL 8 업그레이드 + 읽기/쓰기 분리\n\n작업:\n1. MySQL 5.7 → 8.0 업그레이드 (호환성 테스트 필수)\n2. 읽기 복제본 2개 구성\n3. ProxySQL 도입\n   - 쓰기 쿼리 → Primary\n   - 읽기 쿼리 → Replicas (라운드 로빈)\n4. 애플리케이션 커넥션 ProxySQL로 전환\n\n예상 효과: 읽기 부하 90% 분산, Primary 여유 확보\n```\n\n### Phase 2: 쿼리 최적화\n```\n목표: 느린 쿼리 해결\n\n작업:\n1. slow query log 분석 (pt-query-digest)\n2. 상위 20개 느린 쿼리 식별\n3. MySQL 8 기능으로 리팩토링\n   - CTE로 복잡한 서브쿼리 정리\n   - 윈도우 함수로 self-JOIN 제거\n4. 복합 인덱스 최적화\n5. 저장 프로시저 점진적 리팩토링\n\n예상 효과: 평균 쿼리 응답시간 50%+ 개선\n```\n\n### Phase 3: 분석 분리\n```\n목표: OLTP/OLAP 워크로드 분리\n\n작업:\n1. 분석 전용 복제본 구성 (지연 허용)\n2. ClickHouse 또는 BigQuery 도입 (선택)\n   - 일배치로 분석 데이터 동기화\n3. 분석 쿼리 완전 분리\n\n예상 효과: 운영 DB에서 분석 쿼리 부하 제거\n```\n\n### Phase 4: 스키마 유연성 (선택적)\n```\n목표: 자주 변경되는 필드 유연화\n\n작업:\n1. 변경 빈번한 테이블 식별\n2. JSON 컬럼 + 가상 컬럼 패턴 적용\n   \n   예시:\n   ALTER TABLE products \n   ADD COLUMN attributes JSON,\n   ADD COLUMN brand VARCHAR(100) \n     GENERATED ALWAYS AS (attributes->>'$.brand') STORED;\n\n3. 신규 필드는 JSON으로, 안정된 필드는 정규 컬럼 유지\n\n예상 효과: 스키마 변경 없이 새 속성 추가 가능\n```\n\n---\n\n## 비용 대비 효과\n\n| 옵션 | 초기 비용 | 운영 비용 | 리스크 | ROI |\n|------|----------|----------|--------|-----|\n| A) MySQL 8 + ProxySQL | 낮음 | 낮음 | 낮음 | ★★★★★ |\n| B) PostgreSQL + Citus | 높음 | 중간 | 중간 | ★★★☆☆ |\n| C) MongoDB 폴리글랏 | 중간 | 높음 | 높음 | ★★☆☆☆ |\n| D) PlanetScale/TiDB | 낮음 | 높음 | 중간 | ★★★☆☆ |\n\n---\n\n## 결론\n\n**옵션 A를 추천하는 핵심 이유:**\n\n1. **9:1 읽기 비율** → 읽기 복제본만으로 대부분의 부하 해결\n2. **저장 프로시저 50개** → 다른 DB로 이전 시 재작성 비용 막대\n3. **점진적 개선 가능** → 빅뱅 마이그레이션 리스크 회피\n4. **MySQL 8의 개선점** → CTE, 윈도우 함수, JSON, 병렬 쿼리 등\n\n쓰기 확장이 병목이 되는 시점(현재는 아님)에 샤딩이나 NewSQL 검토를 권장합니다.",
    "timeMs": 49335
  },
  "multiParallel": {
    "responses": [
      {
        "ai": "claude",
        "content": "# MySQL 시스템 현대화 전략 분석\n\n## 요약 권장사항\n\n**Option A: MySQL 8 + 읽기 복제본 + ProxySQL**을 1차 권장합니다.\n\n이유: 위험 최소화, 검증된 패턴, 점진적 개선 가능\n\n---\n\n## 선택지별 상세 분석\n\n### Option A: MySQL 8 + 읽기 복제본 + ProxySQL ✅ 권장\n\n```\n┌─────────────┐     ┌─────────────┐\n│  Application │────▶│  ProxySQL   │\n└─────────────┘     └──────┬──────┘\n                           │\n          ┌────────────────┼────────────────┐\n          ▼                ▼                ▼\n    ┌──────────┐    ┌──────────┐    ┌──────────┐\n    │  Primary │    │ Replica 1│    │ Replica 2│\n    │  (Write) │    │  (Read)  │    │(Analytics)│\n    └──────────┘    └──────────┘    └──────────┘\n```\n\n**장점:**\n- 저장 프로시저 50개 그대로 유지\n- 애플리케이션 코드 변경 최소화\n- 9:1 읽기 비율에 최적 (읽기 복제본으로 분산)\n- MySQL 8의 CTE, Window Function으로 복잡한 JOIN 최적화\n- 운영팀 학습 곡선 없음\n\n**단점:**\n- 쓰기 확장에 한계 (10% 쓰기 = 300 QPS, 현재 수준에서 충분)\n- 근본적 스키마 유연성 개선 없음\n\n**적합 이유:** 현재 문제의 핵심이 \"느린 쿼리\"와 \"읽기 부하\"임. 쓰기 300 QPS는 단일 MySQL이 충분히 처리.\n\n---\n\n### Option B: PostgreSQL + Citus\n\n**장점:**\n- 진정한 수평 분산 쓰기\n- JSONB로 스키마 유연성\n- 분석 기능 우수\n\n**단점:**\n- 저장 프로시저 50개 전체 재작성 (PL/pgSQL 문법 다름)\n- 마이그레이션 기간 6개월+\n- 팀 PostgreSQL 경험 필요\n\n**판단:** 현재 쓰기 부하(300 QPS)로는 분산 쓰기 불필요. 오버엔지니어링.\n\n---\n\n### Option C: MongoDB 폴리글랏\n\n**장점:**\n- 스키마 유연성 극대화\n- 특정 도메인에 최적화 가능\n\n**단점:**\n- 두 DB 운영 복잡성\n- 트랜잭션 일관성 관리 어려움\n- JOIN이 필요한 데이터 분리 시 애플리케이션 복잡도 급증\n\n**판단:** 200개 테이블 중 JOIN 관계 파악 후에도 분리 가능한 독립 도메인이 명확해야 함. 현재 정보로는 위험.\n\n---\n\n### Option D: PlanetScale/TiDB\n\n**장점:**\n- MySQL 호환 + 수평 확장\n- 스키마 변경 온라인으로 쉬움\n- 관리형 서비스로 운영 부담 감소\n\n**단점:**\n- **저장 프로시저 미지원** (PlanetScale) 또는 제한적 (TiDB)\n- 비용: 500GB + 3000 QPS → 월 $2,000~5,000 예상\n- 벤더 종속\n\n**판단:** 저장 프로시저 50개가 핵심 비즈니스 로직이면 즉시 탈락.\n\n---\n\n## 마이그레이션 단계 (Option A 기준)\n\n### Phase 1: 인프라 준비\n```\n1. MySQL 8.0 업그레이드 테스트 환경 구축\n2. 호환성 검증 (mysql_upgrade, 예약어 충돌 확인)\n3. 읽기 복제본 1대 추가\n4. ProxySQL 도입 (읽기/쓰기 분리)\n```\n\n### Phase 2: 쿼리 최적화\n```\n1. slow_query_log 분석으로 상위 20개 문제 쿼리 식별\n2. MySQL 8 기능 활용 재작성:\n   - CTE로 서브쿼리 정리\n   - Window Function으로 복잡한 GROUP BY 대체\n3. 인덱스 최적화 (EXPLAIN ANALYZE 활용)\n```\n\n### Phase 3: 분석 분리\n```\n1. 분석 전용 복제본 추가\n2. ClickHouse/BigQuery로 분석 쿼리 오프로드 (선택)\n3. OLTP/OLAP 완전 분리\n```\n\n### Phase 4: 스키마 유연성 (필요시)\n```\n1. JSON 컬럼 도입 (MySQL 8 JSON 함수)\n2. 자주 변경되는 속성을 JSON으로 이전\n3. 점진적으로 정규화 완화\n```\n\n---\n\n## 아키텍처 최종안\n\n```\n                    ┌─────────────────────────────────────┐\n                    │           Application               │\n                    └──────────────────┬──────────────────┘\n                                       │\n                    ┌──────────────────▼──────────────────┐\n                    │            ProxySQL                 │\n                    │    (Query Routing + Connection Pool)│\n                    └──────────────────┬──────────────────┘\n                                       │\n        ┌──────────────────────────────┼──────────────────────────────┐\n        │                              │                              │\n        ▼                              ▼                              ▼\n┌───────────────┐            ┌───────────────┐            ┌───────────────┐\n│   MySQL 8.0   │            │   MySQL 8.0   │            │   MySQL 8.0   │\n│    Primary    │───복제────▶│   Replica 1   │            │   Replica 2   │\n│    (Write)    │            │    (Read)     │            │  (Analytics)  │\n└───────────────┘            └───────────────┘            └───────┬───────┘\n                                                                  │\n                                                                  ▼\n                                                          ┌───────────────┐\n                                                          │  ClickHouse   │\n                                                          │  (Optional)   │\n                                                          └───────────────┘\n```\n\n---\n\n## 결론\n\n| 기준 | Option A | Option B | Option C | Option D |\n|------|----------|----------|----------|----------|\n| 마이그레이션 위험 | 낮음 | 높음 | 중간 | 중간 |\n| 저장프로시저 호환 | ✅ 100% | ❌ 재작성 | ⚠️ 일부 | ❌ 미지원 |\n| 읽기 확장 | ✅ | ✅ | ✅ | ✅ |\n| 쓰기 확장 | ⚠️ 한계 | ✅ | ⚠️ | ✅ |\n| 비용 | 낮음 | 중간 | 중간 | 높음 |\n\n**현재 상황(쓰기 300 QPS, 저장 프로시저 의존)에서 Option A가 최적입니다.**\n\n쓰기 부하가 1000+ QPS로 증가하면 그때 Option D(TiDB)를 재검토하세요."
      },
      {
        "ai": "gemini",
        "content": "**추천 전략: D) TiDB (NewSQL) 도입** (단, PlanetScale은 저장 프로시저 미지원으로 제외)\n\n가장 권장하는 전략은 **TiDB**로의 마이그레이션입니다. 귀하의 목표인 '수평 확장', '분석 쿼리 처리', 'MySQL 호환성'을 동시에 만족시키는 최적의 솔루션입니다.\n\n### 1. 추천 이유 (Why TiDB?)\n\n*   **MySQL 호환성 & 마이그레이션 용이성:** MySQL 5.7 프로토콜과 호환되므로 애플리케이션 코드 수정이 최소화됩니다. PostgreSQL(B안)로의 변경보다 리스크가 훨씬 적습니다.\n*   **HTAP (Hybrid Transactional/Analytical Processing):** TiDB는 행 기반 저장소(TiKV)와 열 기반 저장소(TiFlash)를 동시에 운영합니다.\n    *   기존 OLTP 트래픽은 TiKV가 처리.\n    *   **문제점이었던 \"복잡한 JOIN\"과 \"분석 쿼리\"**는 TiFlash로 격리하여 처리하므로 메인 DB 성능 저하 없이 고속 분석이 가능합니다.\n*   **수평 확장 (Sharding 불필요):** 데이터가 늘어나면 노드만 추가하면 됩니다. 3000 QPS는 TiDB 입장에서 가벼운 부하이지만, 향후 트래픽 급증 시 별도의 샤딩 로직 없이 대응 가능합니다.\n*   **온라인 DDL:** 스키마 변경 시 락(Lock)이 걸리지 않아 서비스 중단 없이 유연하게 컬럼을 추가/수정할 수 있습니다.\n\n---\n\n### 2. 단계별 마이그레이션 계획 (Migration Strategy)\n\n기존 시스템이 10년 된 레거시이므로 \"빅뱅\" 방식보다는 **점진적 전환**을 추천합니다.\n\n#### **Step 1: 사전 평가 및 리팩토링 (가장 중요)**\n*   **저장 프로시저(SP) 진단:** TiDB는 저장 프로시저를 지원하지만, MySQL과 100% 동일하지 않으며 성능상 애플리케이션 레벨로 로직을 옮기는 것이 현대화의 핵심입니다.\n    *   *Action:* 50개의 SP 중 비즈니스 로직이 포함된 복잡한 SP를 우선 식별하여 Go/Java/Node.js 등의 애플리케이션 코드로 변환합니다.\n*   **호환성 체크:** TiDB 제공 툴을 사용하여 현재 DDL 및 쿼리 호환성을 검증합니다.\n\n#### **Step 2: 인프라 구축 및 데이터 동기화 (CDC)**\n*   TiDB 클러스터를 구축합니다. (TiKV 3노드 + TiDB 2노드 + TiFlash 1노드 권장)\n*   **DM (Data Migration) 도구**를 사용하여 MySQL 5.7의 데이터를 TiDB로 실시간 복제합니다.\n    *   초기 적재(Full Load) + 증분 복제(Binlog Replication)를 설정하여 실시간 동기화를 유지합니다.\n\n#### **Step 3: 읽기 트래픽 분산 (Canary Release)**\n*   현재 읽기/쓰기 비율이 9:1이므로 리스크가 적은 **읽기 트래픽(SELECT)**부터 점진적으로 TiDB로 라우팅합니다.\n*   특히 \"복잡한 JOIN\"이 발생하는 무거운 분석 쿼리를 TiDB(TiFlash 엔진)로 보내 성능 향상을 검증합니다.\n\n#### **Step 4: 쓰기 트래픽 전환 및 컷오버**\n*   애플리케이션의 DB 연결을 TiDB로 완전히 전환합니다.\n*   안정성이 확인되면 기존 MySQL 5.7을 종료합니다.\n\n---\n\n### 3. 대안 비교 (왜 다른 선택지는 아닌가?)\n\n*   **A) MySQL 8 + ProxySQL:**\n    *   가장 안전하지만, **\"복잡한 JOIN으로 인한 느린 쿼리\"**와 **\"스키마 유연성\"** 문제를 근본적으로 해결하지 못합니다. 단순히 하드웨어 스펙만 올리는 꼴이 될 수 있습니다.\n*   **B) PostgreSQL + Citus:**\n    *   성능은 훌륭하나, **50개의 저장 프로시저**와 **200개의 테이블**을 PG 문법으로 변환하는 공수가 너무 큽니다. 마이그레이션 기간이 2배 이상 소요될 수 있습니다.\n*   **C) Polyglot (MySQL + Mongo):**\n    *   운영 복잡도가 급증합니다. 트랜잭션 일관성을 맞추기 위해 2PC(2-Phase Commit)나 별도의 파이프라인 관리가 필요하여 3인 이하의 DBA/백엔드 팀에게는 오버엔지니어링입니다.\n\n### 결론\n**TiDB**를 도입하여 **기존 MySQL 호환성을 유지하면서 분석 성능과 확장성을 확보**하는 것이 가장 효율적인 현대화 방안입니다. 단, 마이그레이션 전 **저장 프로시저의 애플리케이션 이관**을 최우선 과제로 삼으시길 권장합니다."
      },
      {
        "ai": "codex",
        "content": "추천: D) PlanetScale/TiDB (NewSQL) — 수평 확장, 스키마 변경 유연성, 분석 분리 요구에 가장 균형적입니다. 특히 MySQL 기반 워크로드/쿼리/운영 경험을 살리면서 수평 확장(샤딩), 온라인 스키마 변경, 복제/다중 리전, 트랜잭션을 제공합니다. 분석 쿼리는 별도 OLAP(ClickHouse/BigQuery/Snowflake)로 분리하는 전제를 같이 가져가야 합니다.\n\n간단 비교\n- A) MySQL 8 + 읽기 복제본 + ProxySQL: 단기 개선은 쉽지만 핵심 문제(복잡 JOIN, 스키마 변경 어려움, 수평 확장 한계)가 그대로 남음.  \n- B) Postgres+Citus: 강력하나 마이그레이션 비용 큼(프로시저/타입/쿼리 차이), 분산 설계 난이도 높음.  \n- C) MongoDB 일부 이전: 복잡 JOIN과 트랜잭션이 많은 시스템이면 이질성 비용이 크고 장기적으로 복잡도 상승.  \n- D) PlanetScale/TiDB: MySQL 호환 + 수평 확장 + 온라인 스키마 변경 + 운영 단순화, 목표에 가장 직접적으로 부합.\n\n권장 마이그레이션 단계\n1) 진단/분류\n- 느린 쿼리 Top N, 주요 테이블 액세스 패턴, 핫스팟 키, 트랜잭션 경로를 분류.\n- 스키마 변경/배포 장애 요인(락, 다운타임) 정리.\n\n2) 아키텍처 목표 정의\n- 샤딩 키 후보(예: tenant_id, customer_id 등) 선정.\n- OLTP vs 분석 워크로드 분리 기준 확정.\n- SLA(지연, 가용성)와 비용 범위 설정.\n\n3) NewSQL PoC\n- 후보 2곳(예: TiDB vs PlanetScale)에서 대표 테이블/쿼리 세트 벤치마킹.\n- 분산 JOIN/secondary index 성능 확인.\n- 온라인 스키마 변경과 백필/멀티리전 복제 검증.\n\n4) 데이터 분리 설계\n- OLTP는 NewSQL로, 분석은 별도 OLAP로 분리.\n- CDC(예: Debezium)로 변경 이벤트를 분석 스토어로 스트리밍.\n\n5) 단계적 마이그레이션\n- 읽기 전환 → 쓰기 전환 순서.\n- 트래픽 분기(프록시/피처 플래그)로 위험 최소화.\n- 가장 트래픽 큰 테이블부터 이동하고, 앱 레이어에서 라우팅.\n\n6) 프로시저/쿼리 정리\n- 저장 프로시저는 앱 계층으로 이관하거나 NewSQL 호환 형태로 리팩터링.\n- 복잡 JOIN은 materialized view/비정규화/서브쿼리 최적화 병행.\n\n7) 안정화/최적화\n- 샤딩 키 재평가, 핫스팟 완화, 인덱스 재구성.\n- 읽기 복제/캐시 계층(예: Redis) 추가로 QPS 완충.\n\n원하면 현재 쿼리/스키마 특성을 더 알려주시면 A/B/D 중 최적안을 더 좁혀 추천해 드릴게요."
      }
    ],
    "timeMs": 82272
  },
  "multiDebate": {
    "rounds": [
      {
        "ai": "claude",
        "content": "# MySQL 시스템 현대화 전략 분석\n\n## 추천: **A) MySQL 8 + 읽기 복제본 + ProxySQL**\n\n### 추천 이유\n\n**현재 상황에 가장 적합한 선택입니다:**\n\n| 요소 | 분석 |\n|------|------|\n| **읽기/쓰기 9:1** | 읽기 복제본으로 즉시 90% 부하 분산 가능 |\n| **저장 프로시저 50개** | 다른 DB로 이전 시 전체 재작성 필요 → 리스크 |\n| **500GB 단일 인스턴스** | 아직 샤딩이 필수적인 규모가 아님 |\n| **3000 QPS** | MySQL 8 + 복제본으로 충분히 처리 가능 |\n\n---\n\n## 선택지별 비교\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│ 옵션 A: MySQL 8 + 복제본                                        │\n│ ✅ 리스크 최소 (같은 DB 엔진)                                    │\n│ ✅ 저장 프로시저 그대로 사용                                     │\n│ ✅ 팀 학습 곡선 없음                                            │\n│ ⚠️  장기적 샤딩 필요 시 추가 작업                                │\n├─────────────────────────────────────────────────────────────────┤\n│ 옵션 B: PostgreSQL + Citus                                      │\n│ ✅ 분석 쿼리에 강점                                              │\n│ ❌ 전체 마이그레이션 필요 (SP 50개 재작성)                        │\n│ ❌ 문법 차이로 애플리케이션 수정 다수                             │\n├─────────────────────────────────────────────────────────────────┤\n│ 옵션 C: MongoDB 폴리글랏                                        │\n│ ❌ 복잡한 JOIN → NoSQL에 부적합                                  │\n│ ❌ 두 DB 동기화 복잡성                                           │\n│ ❌ 트랜잭션 일관성 관리 어려움                                    │\n├─────────────────────────────────────────────────────────────────┤\n│ 옵션 D: PlanetScale/TiDB                                        │\n│ ✅ MySQL 호환, 수평 확장 내장                                    │\n│ ⚠️  저장 프로시저 제한적 지원                                    │\n│ ⚠️  비용 증가, 벤더 종속성                                       │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## 마이그레이션 단계\n\n### Phase 1: 즉각적 성능 개선\n```\n[현재 MySQL 5.7] \n       │\n       ▼\n[MySQL 8.0 업그레이드] ──→ 새로운 옵티마이저, 윈도우 함수\n       │\n       ▼\n[읽기 복제본 2~3대 추가]\n       │\n       ▼\n[ProxySQL 도입] ──→ 읽기/쓰기 자동 분리\n```\n\n**작업 내용:**\n1. MySQL 8.0 업그레이드 (호환성 테스트)\n2. 읽기 복제본 2~3대 구성\n3. ProxySQL로 쿼리 라우팅 설정\n4. 느린 쿼리 인덱스 최적화\n\n### Phase 2: 분석 쿼리 분리\n```\n[OLTP: MySQL 8 클러스터]\n       │\n       │ CDC (Debezium)\n       ▼\n[OLAP: ClickHouse 또는 BigQuery]\n```\n\n**작업 내용:**\n1. 분석용 데이터 파이프라인 구축\n2. 무거운 리포팅 쿼리를 OLAP으로 이전\n3. OLTP 부하 추가 감소\n\n### Phase 3: 장기 확장성 (필요 시)\n```\n[필요 시점에 검토]\n├── Vitess 도입 (MySQL 샤딩)\n├── 또는 TiDB 전환\n└── 또는 마이크로서비스 분리\n```\n\n---\n\n## 핵심 포인트\n\n**지금 당장 B, C, D를 선택하지 않는 이유:**\n\n1. **저장 프로시저 50개** = 마이그레이션 비용 매우 높음\n2. **500GB**는 단일 MySQL로 충분히 관리 가능한 크기\n3. 읽기 복제본만으로 현재 문제의 80%는 해결됨\n4. 복잡한 JOIN 문제는 DB를 바꿔도 해결되지 않음 → 쿼리 최적화가 본질\n\n**옵션 D(PlanetScale/TiDB)는 차선책으로 유효합니다** - 저장 프로시저 의존도를 먼저 줄일 수 있다면 고려할 만합니다."
      },
      {
        "ai": "gemini",
        "content": "# MySQL 시스템 현대화 전략 (Gemini 의견)\n\n## 핵심 추천: **Phase 1은 Option A, Phase 2는 애플리케이션 리팩토링**\n\nClaude의 분석에 동의하며, **리스크 관리 관점에서 Option A(MySQL 8 + ProxySQL)**가 유일한 현실적 대안입니다. 하지만 \"현대화(Modernization)\"라는 목표를 달성하기 위해서는 Claude가 제안한 인프라 변경 외에 **애플리케이션 아키텍처 개선**이 반드시 병행되어야 합니다.\n\n---\n\n### 1. 전략적 분석 (Why Option A?)\n\n가장 결정적인 제약 사항은 **저장 프로시저(SP) 50개**입니다.\n\n| 옵션 | SP 호환성 | 마이그레이션 난이도 | 평가 |\n|------|-----------|-------------------|------|\n| **A) MySQL 8** | **완벽 호환** | **Low** | **최선 (즉시 적용 가능)** |\n| B) PostgreSQL | 문법 재작성 필요 (PL/pgSQL) | High | 비즈니스 로직 50개를 동시에 포팅하는 건 실패 확률 매우 높음 |\n| C) MongoDB | **지원 불가** | Extreme | 관계형 데이터(JOIN)를 문서형으로 바꾸는 건 재앙이 될 수 있음 |\n| D) TiDB/PlanetScale | **제한적/지원 안 함** | High | PlanetScale은 SP 미지원. TiDB는 지원하지만 MySQL과 100% 호환되지 않음 |\n\n**결론:** 비즈니스 로직(SP)을 애플리케이션으로 옮기기 전까지는 DB 엔진 변경(B, C, D)은 불가능합니다.\n\n---\n\n### 2. 제안하는 현대화 로드맵\n\n단순히 DB 버전을 올리는 것을 넘어, 진정한 현대화를 위한 3단계 접근을 제안합니다.\n\n#### **Phase 1: 인프라 안정화 (1~3개월)**\n*   **목표:** 성능 병목 해소 및 운영 안정성 확보\n*   **Action:**\n    1.  **MySQL 8.0 업그레이드:** CTE(Common Table Expression) 등을 활용해 복잡한 JOIN 쿼리 최적화 가능\n    2.  **ProxySQL 도입:** 애플리케이션 코드 수정 없이 읽기/쓰기 분리 (3000 QPS 분산)\n    3.  **읽기 복제본(Read Replica) 증설:** 분석/리포팅 쿼리를 복제본으로 강제 라우팅\n*   **기대 효과:** 즉각적인 QPS 여유 확보, 느린 쿼리 개선\n\n#### **Phase 2: 애플리케이션 현대화 (3~12개월)**\n*   **목표:** **\"저장 프로시저 제거\"** (진정한 현대화의 핵심)\n*   **이유:** SP는 디버깅이 어렵고, 버전 관리가 힘들며, DB 확장에 걸림돌이 됩니다.\n*   **Action:**\n    1.  저장 프로시저 50개의 로직을 애플리케이션 계층(API 서버)으로 이동\n    2.  복잡한 JOIN 쿼리를 애플리케이션 레벨의 조합이나 ORM/Query Builder로 전환 가능한지 검토\n*   **기대 효과:** DB 의존성 제거 → 향후 NewSQL이나 NoSQL로 갈 수 있는 자유 확보\n\n#### **Phase 3: 아키텍처 분리 (1년 이후, 필요 시)**\n*   **목표:** 무제한 확장성 확보\n*   **Action:**\n    1.  **분석 분리:** Phase 1에서 한계가 오면 CDC(Debezium)를 통해 **ClickHouse**나 **BigQuery**로 데이터 실시간 적재 (Claude 의견과 동일)\n    2.  **샤딩/NewSQL:** SP가 제거된 상태라면, 데이터가 급증할 때 **TiDB**로 전환하거나 **Vitess** 도입 (이 시점엔 마이그레이션이 훨씬 쉬움)\n\n---\n\n### 3. Claude 답변에 대한 첨언\n\n*   **동의:** 500GB/3000 QPS는 아직 샤딩(Sharding)이나 NewSQL이 필수적인 단계는 아닙니다. 오버엔지니어링을 피해야 합니다.\n*   **보완:** Claude는 \"저장 프로시저 그대로 사용\"을 장점으로 꼽았지만, 장기적으로는 **이것이 가장 큰 기술 부채**입니다. 마이그레이션 계획에 'SP의 애플리케이션 로직 전환'이 반드시 포함되어야 합니다. 그렇지 않으면 3년 뒤에도 똑같은 고민을 하게 됩니다.\n\n### 요약 추천\n**\"Option A로 당장의 불을 끄고, 1년 동안 저장 프로시저를 걷어내는 리팩토링을 진행하십시오. 그 후에 TiDB나 PostgreSQL을 고민해도 늦지 않습니다.\"**"
      },
      {
        "ai": "codex",
        "content": "추천: **A를 단기 해법으로 채택 + 중기적으로 “SP(저장 프로시저) 탈피 & 분석 분리” 로드맵**입니다.  \n현재 제약(50개 SP, 복잡 JOIN, 9:1 read/write)과 리스크를 고려하면 **즉시 효과/안정성/비용 대비 효율**이 A가 가장 높습니다. 다만 “현대화” 목표를 달성하려면 **SP 의존도 축소와 분석 분리**가 반드시 따라와야 합니다.\n\n**왜 A가 최우선인가**\n- SP 50개는 B/C/D에서 가장 큰 마이그레이션 리스크 (재작성·품질·운영 리스크)\n- 500GB/3000 QPS는 MySQL 8 + 리드 레플리카로 충분히 감당 가능\n- 읽기 90%는 ProxySQL로 즉각 분산 가능\n\n**대안에 대한 한 줄 평가**\n- B) PG+Citus: 분석에는 강점, 하지만 SP 재작성 + 앱 수정 대규모 → 위험/기간 큼\n- C) MongoDB: 복잡 JOIN 다수면 모델링·일관성·운영 복잡도 폭증\n- D) PlanetScale/TiDB: 수평 확장 매력적이나 SP 제약/호환성/비용·벤더락 고려 필요\n\n---\n\n**추천 마이그레이션 단계**\n\n**Phase 0: 진단 (2~4주)**\n- 슬로우 쿼리/핫 테이블/락 경합 분석\n- SP별 호출 빈도/비즈니스 영향도 분류\n- 리포팅/분석 쿼리 목록화\n\n**Phase 1: 안정화 (1~3개월)**\n- MySQL 8 업그레이드 (쿼리 최적화/옵티마이저 개선 활용)\n- 리드 레플리카 2~3대 구성\n- ProxySQL로 읽기/쓰기 분리 및 라우팅 정책 적용\n- 인덱스/쿼리 튜닝 (복잡 JOIN 우선)\n\n**Phase 2: 분석 분리 (3~6개월)**\n- CDC(Debezium 등)로 OLAP 저장소(ClickHouse/BigQuery/Redshift 등) 구축\n- 리포팅/분석 쿼리를 OLAP으로 이전 → OLTP 부담 감소\n\n**Phase 3: 구조적 현대화 (6~12개월)**\n- 저장 프로시저 로직을 애플리케이션 계층으로 이전\n- 핵심 도메인별 스키마 분할/서비스 분리 검토\n\n**Phase 4: 수평 확장 옵션 검토 (12개월+)**\n- SP 의존도 낮아진 뒤에 TiDB/PlanetScale/Vitess 등 선택지 재평가\n\n---\n\n원하면 다음을 알려주세요:\n- SP 중 “변경 난이도/중요도” 분류 기준\n- 분석 쿼리의 형태/빈도\n- 현재 장애 지표(슬로우쿼리 TOP 10, 락 경합, 리플리카 지연)\n\n그럼 Phase 0~1의 구체 실행 체크리스트까지 정리해줄게요."
      }
    ],
    "conclusion": "## 최종 권장사항: A안 (MySQL 8 + 읽기 복제본 + ProxySQL) 단기 채택 + SP 탈피 중기 로드맵\n\n### 핵심 합의점\n\n세 AI 모두 다음을 일치하게 동의합니다:\n\n1. **즉시 해결책: Option A (MySQL 8 + 복제본 + ProxySQL)**\n   - 500GB/3000 QPS 규모에서 가장 현실적\n   - 저장 프로시저 50개의 호환성 문제 회피 불가능\n   - 읽기 90% 비율을 ProxySQL로 즉각 분산 가능\n   - 리스크 최소, 3~6개월 내 성능 개선 실현 가능\n\n2. **장기 목표: \"저장 프로시저 의존도 제거\"**\n   - SP는 DB 확장의 가장 큰 기술 부채\n   - Phase 2에서 SP 로직을 애플리케이션 계층으로 이동\n   - 이를 통해 향후 TiDB/PlanetScale 전환 자유도 확보\n\n3. **분석 쿼리 분리 필수**\n   - OLTP(MySQL) / OLAP(ClickHouse/BigQuery) 분리\n   - CDC(Debezium)로 실시간 데이터 파이프라인 구축\n\n### 주요 이견점\n\n| 관점 | Claude | Gemini | Codex |\n|------|--------|--------|-------|\n| **단기 액션** | A안 채택 | A안 채택 + Phase 2 SP 제거 강조 | A안 + 진단 Phase 0 추가 |\n| **SP 평가** | \"그대로 사용 가능 (장점)\" | \"기술 부채 (단점)\" | \"탈피 필수\" |\n| **옵션 D 평가** | 차선책 (SP 제약 있음) | 미지원으로 기각 | SP 제약/호환성 고려 필요 |\n\n**가장 중요한 차이:** Claude는 단기 편의성을, Gemini/Codex는 **장기 기술 부채 관점에서 SP 제거를 강조**합니다. 실무적으로는 **Gemini의 관점이 더 타당**합니다.\n\n### 최종 권장사항\n\n#### **4단계 로드맵 (공통 동의)**\n\n```\nPhase 0 (2~4주): 진단\n├─ 슬로우 쿼리/핫 테이블 분석\n├─ SP 50개 분류 (호출빈도/비즈니스 영향도)\n└─ 분석 쿼리 목록화\n\nPhase 1 (1~3개월): 인프라 안정화 ✓ 즉시 시작\n├─ MySQL 8.0 업그레이드\n├─ 읽기 복제본 2~3대 구성\n├─ ProxySQL 도입 (읽기/쓰기 분리)\n└─ 기대효과: QPS 여유, 슬로우 쿼리 개선\n\nPhase 2 (3~6개월): 분석 분리 & 시작 (SP 탈피 준비)\n├─ CDC(Debezium) 파이프라인 구축\n├─ ClickHouse/BigQuery로 리포팅 이전\n├─ SP 중 변경 용이한 것부터 앱 로직으로 이동 시작\n└─ 기대효과: OLTP 부담 감소, SP 의존도 단계적 감소\n\nPhase 3 (6~12개월): 구조적 현대화\n├─ SP 50개 → 애플리케이션 계층 전환 완료\n├─ ORM/쿼리빌더 도입으로 복잡 JOIN 개선\n└─ 기대효과: DB 독립성 확보\n\nPhase 4 (12개월+): 수평 확장 재평가\n├─ TiDB/PlanetScale/Vitess 기술 검토\n└─ SP 제거 완료 상태에서 선택 (당시의 트렌드 반영)\n```\n\n#### **즉시 실행 체크리스트 (Phase 0~1)**\n\n1. **MySQL 8.0 업그레이드 계획** (호환성 테스트 필수)\n2. **읽기 복제본 아키텍처 설계** (2~3대 권장)\n3. **ProxySQL 파일럿** (프로덕션 전 QA 검증)\n4. **느린 쿼리 TOP 10 분석** (CTE/윈도우 함수 최적화)\n5. **SP 50개 매핑** (Phase 2 이동 우선순위 결정)\n\n#### **옵션 B/C/D를 피해야 하는 이유 (최종 판정)**\n\n- **B) PostgreSQL + Citus:** SP 재작성(50개) + 앱 수정 → 리스크 극대화\n- **C) MongoDB:** 복잡 JOIN 환경에서 모델링/일관성 악몽\n- **D) TiDB/PlanetScale:** SP 제약/호환성 이슈 + 벤더락 → Phase 2 이후 재검토\n\n---\n\n### 최종 결론\n\n**\"A안으로 당장의 성능 위기를 해소하되, 1년 동안 저장 프로시저 탈피 로드맵을 병행하라. 이를 통해 3년 뒤의 수평 확장 선택지(TiDB/PlanetScale)를 자유롭게 가져갈 수 있다.\"**\n\n비용 대비 효율: **A >> B/C/D** (리스크/기간/품질 모두)\n\n다음 액션: Phase 0 진단 시작 (2주 내)\n",
    "timeMs": 222344
  },
  "analysis": {
    "singleLength": 3237,
    "parallelLength": 7699,
    "debateLength": 6020,
    "debateRounds": 3
  }
}